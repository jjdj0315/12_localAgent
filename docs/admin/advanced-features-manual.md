# 고급 기능 관리 매뉴얼

**대상**: 시스템 관리자  
**마지막 업데이트**: 2025-10-31  
**버전**: 1.0

## 개요

이 문서는 Local LLM 웹 애플리케이션의 고급 기능(안전 필터, ReAct 도구, 멀티 에이전트 시스템) 관리 방법을 설명합니다.

---

## 1. 안전 필터 관리 (Safety Filter)

### 1.1 개요
안전 필터는 부적절한 콘텐츠와 개인정보를 탐지하고 차단합니다.

- **2단계 필터링**: 규칙 기반 → ML 기반
- **5가지 카테고리**: 폭력성, 성적 내용, 위험한 질문, 혐오 발언, 개인정보
- **자동 PII 마스킹**: 주민등록번호, 전화번호, 이메일

### 1.2 키워드 관리

#### 키워드 추가
관리자 패널 > 안전 필터 > 키워드 관리

```
카테고리: 폭력성
키워드: 살인, 폭행, 테러, ...
```

#### 키워드 삭제
- 오탐지(false positive)를 유발하는 키워드 제거
- 예: 정부 업무에 필요한 단어가 차단되는 경우

#### 적용 시점
- 키워드 변경 즉시 적용 (재시작 불필요)

### 1.3 카테고리 관리

#### 카테고리 활성화/비활성화
```
✓ 폭력성 (활성)
✓ 성적 내용 (활성)
✗ 혐오 발언 (비활성) ← 오탐지가 많은 경우
```

### 1.4 ML 모델 설정

#### 신뢰도 임계값 조정
- **기본값**: 0.7 (70%)
- **높게 설정** (0.9): 오탐지 감소, 탐지 누락 증가
- **낮게 설정** (0.5): 탐지율 증가, 오탐지 증가

```bash
# 임계값 조정 (관리자 패널 또는 API)
PUT /api/v1/admin/safety-filter/threshold
{
  "threshold": 0.8
}
```

### 1.5 필터 통계 확인

관리자 패널 > 안전 필터 > 통계

- 일일 차단 건수 (카테고리별)
- 입력/출력 필터링 비율
- 오탐지 신고 내역

### 1.6 오탐지 처리

사용자가 "재시도" 버튼을 클릭한 경우:
- 규칙 기반 필터 우회
- ML 모델만 적용
- 로그에 재시도 기록

관리자는 재시도 로그를 검토하여 키워드 조정

---

## 2. ReAct 도구 관리

### 2.1 개요
ReAct 에이전트는 6가지 정부 업무 도구를 사용합니다:

1. 문서 검색 도구
2. 계산기 도구
3. 날짜/일정 도구
4. 데이터 분석 도구
5. 문서 템플릿 도구
6. 법규 참조 도구

### 2.2 도구 활성화/비활성화

관리자 패널 > ReAct 도구 > 도구 관리

```
✓ 문서 검색 (활성)
✓ 계산기 (활성)
✗ 데이터 분석 (비활성) ← 보안 이유로 비활성화
```

비활성화된 도구 사용 시:
```
오류: 이 도구는 현재 사용할 수 없습니다.
```

### 2.3 도구 사용 통계

관리자 패널 > ReAct 도구 > 통계

- 도구별 사용 횟수 (일/주/월)
- 평균 실행 시간
- 오류율
- 상위 사용자

### 2.4 도구별 설정

#### 문서 템플릿 커스터마이징
```bash
# 새 템플릿 업로드
POST /api/v1/admin/templates
Content-Type: multipart/form-data

file: custom_template.jinja2
```

템플릿 파일 위치: `/backend/templates/`

#### 한국 공휴일 업데이트
```bash
# korean_holidays.json 수정
/backend/data/korean_holidays.json
```

```json
{
  "2025": [
    {"date": "2025-01-01", "name": "신정"},
    {"date": "2025-02-09", "name": "설날"},
    ...
  ]
}
```

### 2.5 도구 실행 제한

FR-086에 따른 리소스 제한:
- 최대 동시 ReAct 세션: 10개
- 초과 시: 대기열 처리 또는 503 오류

---

## 3. 멀티 에이전트 시스템 관리

### 3.1 개요
5개의 전문 AI 에이전트:

1. 민원 지원 에이전트
2. 문서 작성 에이전트
3. 법규 검색 에이전트
4. 데이터 분석 에이전트
5. 검토 에이전트

### 3.2 에이전트 활성화/비활성화

관리자 패널 > 멀티 에이전트 > 에이전트 관리

```
✓ 민원 지원 (활성)
✓ 문서 작성 (활성)
✓ 법규 검색 (활성)
✗ 데이터 분석 (비활성) ← 필요 시에만 활성화
✓ 검토 (활성)
```

### 3.3 라우팅 모드 설정

#### LLM 기반 라우팅 (기본)
- 더 정확한 의도 파악
- 새로운 질문 패턴 대응
- 추가 LLM 호출 비용 발생

#### 키워드 기반 라우팅 (대안)
- 빠른 성능
- 명시적인 규칙 관리
- 패턴 매칭 한계

```bash
# 라우팅 모드 변경
PUT /api/v1/admin/agents/routing-mode
{
  "mode": "keyword"  # 또는 "llm"
}
```

### 3.4 키워드 패턴 편집

키워드 모드 사용 시:

```
민원 지원 에이전트 키워드:
- 민원
- 건의
- 불만
- 답변 작성

문서 작성 에이전트 키워드:
- 문서 작성
- 보고서
- 공문
- 초안
```

```bash
# 키워드 패턴 업데이트
PUT /api/v1/admin/agents/citizen_support/keywords
{
  "keywords": ["민원", "건의", "불만", "답변 작성"]
}
```

### 3.5 에이전트 성능 모니터링

관리자 패널 > 멀티 에이전트 > 통계

- 에이전트별 작업 건수
- 평균 응답 시간
- 오류율
- 워크플로우 성공률

### 3.6 워크플로우 복잡도 제한

FR-079에 따른 제한:
- 최대 5개 에이전트 (순차)
- 최대 3개 에이전트 (병렬)
- 총 실행 시간 5분

초과 시:
```
작업 시간이 초과되었습니다.
```

### 3.7 에이전트 프롬프트 커스터마이징

에이전트 프롬프트 파일 위치: `/backend/prompts/`

```
citizen_support.txt
document_writing.txt
legal_research.txt
data_analysis.txt
review.txt
```

프롬프트 수정 후 재시작 필요:
```bash
docker-compose restart backend
```

---

## 4. 감사 로그 (Audit Log)

### 4.1 개요
모든 고급 기능 사용 기록:
- 안전 필터 이벤트
- ReAct 도구 실행
- 멀티 에이전트 작업

### 4.2 로그 조회

관리자 패널 > 감사 로그

필터 옵션:
- 날짜 범위
- 사용자
- 액션 타입 (filter/tool/agent)

### 4.3 로그 데이터 구조

```json
{
  "timestamp": "2025-10-31T14:30:00",
  "user_id": "uuid",
  "action_type": "tool",
  "action_details": {
    "tool_name": "calculator",
    "input": "1500000 * 1.05",
    "output": "1575000"
  },
  "result": "success",
  "execution_time_ms": 45
}
```

**중요**: 메시지 내용은 로깅하지 않음 (개인정보 보호)

---

## 5. 리소스 제한 관리

### 5.1 동시 실행 제한 (FR-086)

기본 설정:
- ReAct 세션: 최대 10개
- 멀티 에이전트 워크플로우: 최대 5개

### 5.2 제한 조정

```bash
# 리소스 제한 설정
PUT /api/v1/admin/config/resource-limits
{
  "max_react_sessions": 15,
  "max_agent_workflows": 7
}
```

주의: 서버 리소스 고려하여 설정

### 5.3 대기열 모니터링

관리자 패널 > 시스템 상태 > 대기열

- 현재 대기 중인 요청 수
- 평균 대기 시간
- 리소스 사용률

---

## 6. 문제 해결

### 6.1 안전 필터 과도한 차단
**증상**: 정상 질문도 차단됨

**해결**:
1. 통계에서 오탐지 키워드 확인
2. 해당 키워드 삭제 또는 수정
3. ML 임계값 상향 조정 (0.7 → 0.8)

### 6.2 ReAct 도구 실행 실패
**증상**: "도구 실행이 반복되고 있습니다" 오류

**해결**:
1. 도구 실행 로그 확인
2. 파일 경로 및 권한 확인
3. 도구 재시작 또는 비활성화

### 6.3 멀티 에이전트 라우팅 오류
**증상**: 잘못된 에이전트로 라우팅

**해결**:
1. 키워드 모드: 키워드 패턴 검토 및 업데이트
2. LLM 모드: 프롬프트 파일 확인
3. 라우팅 통계에서 정확도 모니터링

### 6.4 리소스 부족
**증상**: 503 오류 빈번 발생

**해결**:
1. 동시 실행 제한 상향
2. 서버 리소스 증설 (CPU/RAM)
3. 대기열 길이 모니터링

---

## 7. 모범 사례

### 7.1 안전 필터
- 정기적으로 통계 검토 (주 1회)
- 오탐지 신고 즉시 처리
- 신규 키워드는 소규모 테스트 후 적용

### 7.2 ReAct 도구
- 분기별 도구 사용 패턴 분석
- 사용하지 않는 도구 비활성화
- 템플릿은 버전 관리

### 7.3 멀티 에이전트
- 에이전트 성능 월간 리뷰
- 프롬프트 A/B 테스트
- 워크플로우 복잡도 모니터링

### 7.4 감사 로그
- 월간 로그 아카이브
- 이상 패턴 모니터링
- 규정 준수 검토

---

## 8. 참고 자료

- **FR-050~FR-058**: 안전 필터 요구사항
- **FR-060~FR-069**: ReAct 에이전트 요구사항
- **FR-070~FR-080**: 멀티 에이전트 요구사항
- **FR-084**: 커스터마이징 가이드
- **FR-086**: 리소스 제한
- **FR-087**: 우아한 성능 저하

---

## 문의

고급 기능 관련 문제 발생 시 시스템 관리자에게 문의하세요.
