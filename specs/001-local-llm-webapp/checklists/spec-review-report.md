# Spec 검토 보고서

**검토 일시**: 2025-10-28
**검토 대상**: specs/001-local-llm-webapp/spec.md
**검토 방법**: requirements-quality.md 체크리스트 기반 자동 검증
**검토 결과**: 66개 항목 중 23개 개선 필요 항목 발견

---

## 📊 검토 요약

### 통계
- ✅ **통과**: 43개 (65%)
- ⚠️ **개선 필요**: 23개 (35%)
  - 누락된 요구사항: 15개
  - 모호한 요구사항: 6개
  - 충돌/불일치: 2개

### 우선순위별 분류
- 🔴 **높음** (즉시 수정 필요): 8개 - 보안, 초기 설정
- 🟡 **중간** (릴리스 전 수정): 10개 - 성능, 엣지 케이스
- 🟢 **낮음** (선택적 개선): 5개 - 문서화, 세부 사항

---

## 🔴 높은 우선순위 - 즉시 수정 필요 (8개)

### 1. 보안 요구사항 누락 (CHK041-046)

**문제**: 핵심 보안 요구사항이 spec에 누락되어 있음

**누락된 요구사항**:
```markdown
FR-029: 비밀번호 복잡도
- 최소 8자 이상
- 영문, 숫자, 특수문자 중 2종 이상 조합
- 해싱 알고리즘: bcrypt (cost factor 12) 필수

FR-030: 세션 보안
- 동일 사용자의 동시 로그인 허용 (최대 3개 세션)
- 각 세션은 독립적으로 타임아웃 관리
- 강제 로그아웃 시 모든 세션 무효화

FR-031: 접근 제어
- 로그인 실패 시 5회 연속 실패 시 계정 30분 잠금
- 관리자는 잠금 해제 가능
- IP 기반 속도 제한: 동일 IP에서 분당 최대 10회 로그인 시도

FR-032: 데이터 격리
- 데이터베이스 레벨에서 user_id 기반 강제 필터링
- API 레벨에서 세션 사용자 != 요청 리소스 소유자 시 403 반환
- 관리자도 일반 사용자 데이터 직접 접근 불가 (삭제만 가능)

FR-033: 권한 상승 방지
- 관리자 계정은 별도 테이블 관리 (is_admin 플래그 사용 금지)
- 관리자 권한 부여는 데이터베이스 직접 수정으로만 가능
- 관리자 자신의 권한 해제 불가
```

**추가 위치**: spec.md의 "### Functional Requirements" 섹션 (FR-028 다음)

---

### 2. 초기 설정 요구사항 누락 (CHK008)

**문제**: 최초 설치 및 설정에 대한 요구사항 없음

**추가 요구사항**:
```markdown
FR-034: 초기 시스템 설정
- 최초 실행 시 설정 마법사 자동 실행
- 필수 입력 항목:
  - 초기 관리자 계정 (username, password)
  - 시스템 이름 (기본값: "지방자치단체 AI 지원 시스템")
  - 저장소 경로 및 용량 할당
- 설정 완료 후 재설정 불가 (데이터베이스 수동 변경 필요)
- 설정 파일 생성 위치: /config/initial-setup.lock
```

**추가 위치**: spec.md의 "### Functional Requirements" 섹션

---

## 🟡 중간 우선순위 - 릴리스 전 수정 (10개)

### 3. UI 상태 정의 불완전 (CHK001)

**문제**: 로딩 상태는 언급되었으나, 다른 UI 상태 미정의

**개선안**:
```markdown
FR-035: 채팅 UI 상태 정의
시스템은 다음 UI 상태를 명확히 구분하여 표시해야 함:

1. **대기 상태**
   - 입력창 활성화, 플레이스홀더: "질문을 입력하세요"
   - 전송 버튼 비활성화 (입력 없을 때)

2. **입력 중 상태**
   - 전송 버튼 활성화
   - 문자 수 카운터 표시 (예: "125자")

3. **전송/처리 중 상태**
   - 입력창 비활성화
   - 스피너 표시: 회전형 원형 아이콘, 중앙 배치
   - 상태 텍스트: "AI가 답변을 생성하고 있습니다..."
   - 취소 버튼 표시 (선택사항)

4. **스트리밍 응답 상태**
   - 응답 영역에 텍스트 실시간 추가
   - 커서 애니메이션 표시 (타이핑 효과)
   - 입력창 비활성화 유지

5. **완료 상태**
   - 입력창 재활성화
   - 새로운 메시지 입력 가능
   - 이전 대화 스크롤 가능

6. **오류 상태**
   - 빨간색 경고 아이콘 표시
   - 오류 메시지 표시 (예: "답변 생성 실패. 다시 시도해주세요.")
   - 재시도 버튼 표시
```

---

### 4. 응답 품질 기준 모호 (CHK011)

**문제**: "relevant response"가 주관적이고 측정 불가능

**개선안**:
```markdown
기존:
"Then the system displays a relevant answer generated by the local LLM within 10 seconds"

개선:
"Then the system displays an answer that meets the following criteria within 10 seconds:
- 질문 주제와 직접적으로 관련된 내용 포함
- 한국어 문법 오류 없음 (맞춤법, 조사, 어미)
- 완전한 문장으로 구성 (최소 1개 이상의 완결된 문장)
- 질문에서 요청한 정보 유형 제공 (예: 절차 질문 → 단계별 설명)

품질 측정 방법은 SC-004 참조"
```

---

### 5. 컨텍스트 윈도우 크기 미정의 (CHK013)

**문제**: "conversational context" 유지 범위 불명확

**추가 요구사항**:
```markdown
FR-036: 대화 컨텍스트 관리
- 세션 내 컨텍스트: 최근 10개 메시지 (사용자 5개 + AI 5개)
- 컨텍스트 토큰 제한: 최대 2,048 토큰
- 제한 초과 시: 오래된 메시지부터 자동 제거 (FIFO)
- 시스템 메시지 우선순위: 항상 컨텍스트에 포함 (사용자 지침 등)
- 대화 재개 시: 전체 메시지 히스토리 로드하되, 위 규칙 적용
```

---

### 6. 오류 메시지 톤 미정의 (CHK014)

**문제**: "user-friendly language" 구체적 예시 없음

**개선안**:
```markdown
FR-037: 오류 메시지 작성 원칙

모든 오류 메시지는 다음 형식을 따라야 함:

**형식**:
[문제 상황 설명] + [사용자 조치 안내]

**톤 가이드**:
- 존댓말 사용 ("해주세요", "습니다")
- 기술 용어 최소화 (예: "서버 오류" → "일시적인 문제")
- 비난 표현 금지 (예: "잘못 입력했습니다" → "형식이 맞지 않습니다")

**예시**:
- ❌ "Error 500: Internal Server Error"
- ✅ "일시적인 문제가 발생했습니다. 잠시 후 다시 시도해주세요."

- ❌ "Invalid file format"
- ✅ "지원하지 않는 파일 형식입니다. PDF, DOCX, TXT 파일만 업로드 가능합니다."

- ❌ "Authentication failed"
- ✅ "아이디 또는 비밀번호가 일치하지 않습니다. 다시 확인해주세요."
```

---

### 7. 타임아웃 측정 기준 모호 (CHK015)

**문제**: 30분 비활성이 어떤 기준인지 불명확

**개선안**:
```markdown
기존 FR-012:
"System MUST provide session management with automatic timeout after inactivity"

개선:
"FR-012: 시스템은 다음 기준으로 세션을 관리해야 함
- 비활성 기준: 마지막 사용자 요청(클릭, 입력, 스크롤 등) 시점 기준
- 타임아웃: 30분 (1,800초)
- 경고: 타임아웃 3분 전 모달 팝업 표시 ("곧 로그아웃됩니다. 계속하시겠습니까?")
- 타임아웃 시: 자동 로그아웃 + 로그인 페이지 리다이렉트
- 작성 중이던 메시지는 로컬 스토리지에 임시 저장 (재로그인 시 복구 가능)"
```

---

### 8. 사용량 통계 메트릭 미정의 (CHK016)

**문제**: "usage statistics" 구체적 항목 나열 없음

**개선안**:
```markdown
FR-038: 사용량 통계 메트릭 정의

관리자 대시보드는 다음 메트릭을 표시해야 함:

**사용자 메트릭**:
- 총 등록 사용자 수
- 활성 사용자 수 (지난 7일 내 로그인)
- 현재 접속 중인 사용자 수

**쿼리 메트릭**:
- 오늘/이번 주/이번 달 처리된 쿼리 수
- 평균 응답 시간 (P50, P95, P99)
- 실패한 쿼리 비율

**리소스 메트릭**:
- 저장소 사용량 (전체 / 사용자별 상위 5명)
- 메모리 사용량 (%)
- CPU 사용량 (%)

**시스템 메트릭**:
- 서버 가동 시간 (uptime)
- LLM 서비스 상태 (정상/오류)
- 에러 로그 최근 10건
```

---

### 9. 빈 상태 시나리오 미정의 (CHK030)

**추가 요구사항**:
```markdown
FR-039: 빈 상태(Zero-State) UI

**신규 사용자 빈 상태**:
- 대화 목록 화면에 "아직 대화가 없습니다" 메시지 표시
- "새 대화 시작하기" 버튼 강조 (Primary 색상)
- 선택적: 사용 예시 표시 (예: "문서 작성 도움 받기", "정책 질문하기")

**문서 업로드 빈 상태**:
- "업로드된 문서가 없습니다" 메시지
- 드래그 앤 드롭 영역 강조
- 지원 파일 형식 안내 (PDF, DOCX, TXT)

**검색 결과 없음**:
- "검색 결과가 없습니다" 메시지
- 검색어 수정 제안 (예: "다른 키워드로 검색해보세요")
```

---

### 10. 빈 쿼리 처리 미정의 (CHK035)

**추가 요구사항**:
```markdown
EC-009: 빈 쿼리 또는 공백 전용 입력
- **시나리오**: 사용자가 빈 문자열 또는 공백만 입력
- **처리**:
  - 전송 버튼 비활성화 (클라이언트 측)
  - 서버 제출 시 400 Bad Request 반환
  - 오류 메시지: "질문을 입력해주세요."
- **커버**: FR-003
```

---

## 🟢 낮은 우선순위 - 선택적 개선 (5개)

### 11. 로딩 인디케이터 세부사항 (CHK012)

**현재**: "시스템은 로딩 인디케이터를 표시해야 함" (FR-004)

**개선 제안** (선택사항):
```markdown
FR-004 개선:
"시스템은 쿼리 처리 중 다음과 같은 로딩 인디케이터를 표시해야 함:
- 유형: 회전형 원형 스피너 (Material Design 스타일)
- 위치: 입력창 우측 또는 메시지 영역 중앙
- 색상: Primary 색상 (브랜드 컬러)
- 애니메이션: 1초당 1회전
- 텍스트: '답변 생성 중...' (선택사항)"
```

---

### 12. 하드웨어 사양 구체화 (CHK018, CHK053)

**현재**: "Adequate server hardware" (Assumption #2)

**개선 제안**:
```markdown
Assumption #2 개선:
"하드웨어 최소 사양:
- CPU: 8코어 이상 (Intel Xeon 또는 동급)
- RAM: 32GB 이상
- GPU: NVIDIA RTX 3090 또는 A100 (VRAM 16GB 이상, CUDA 지원 필수)
- 저장소: SSD 500GB 이상 (OS + 애플리케이션 + 데이터)
- 네트워크: 내부 Gigabit Ethernet

권장 사양:
- RAM: 64GB
- GPU: NVIDIA A100 (40GB VRAM)
- 저장소: NVMe SSD 1TB"
```

---

### 13. 브라우저 호환성 명시 (CHK050)

**추가 요구사항**:
```markdown
FR-040: 브라우저 호환성
- 지원 브라우저:
  - Chrome 90 이상
  - Edge 90 이상
  - Firefox 88 이상
- 미지원: Internet Explorer (모든 버전)
- 화면 해상도: 최소 1280x720
- JavaScript 필수 활성화
```

---

### 14. 대화 길이 제한 (CHK040)

**추가 요구사항**:
```markdown
FR-041: 대화 길이 제한
- 대화당 최대 메시지 수: 1,000개
- 제한 도달 시: "대화가 너무 깁니다. 새 대화를 시작해주세요." 경고
- 계속 사용 가능하되, 성능 저하 경고 표시
- 관리자는 제한 없음 (디버깅 목적)
```

---

### 15. 중복 제목 처리 (CHK039)

**추가 요구사항**:
```markdown
EC-010: 중복 대화 제목
- **시나리오**: 사용자가 기존과 동일한 제목 입력
- **처리**: 허용 (자동으로 번호 추가 안 함)
- **이유**: 동일 주제로 여러 대화 가능 (날짜로 구분)
```

---

## ⚠️ 충돌/불일치 사항 (2개)

### 16. 응답 길이 제한 vs 문서 생성 (CHK058)

**충돌**:
- FR-017: "4,000자 최대 응답"
- User Story 1: "appropriate draft document 생성"

**분석**:
공문서는 보통 4,000자 초과 가능 (예: 조례안, 보고서)

**해결 방안**:
```markdown
FR-017 수정:
"시스템은 응답 길이를 다음과 같이 제한해야 함:
- 기본 제한: 4,000자
- 문서 생성 모드: 10,000자 (사용자가 명시적으로 '문서 작성' 요청 시)
- 초과 시:
  - 기본: 3,900자에서 잘림 + 경고 메시지
  - 문서 모드: 9,900자에서 잘림 + '더 짧게 요청' 안내"
```

---

### 17. 컨텍스트 보존 범위 모호 (CHK059)

**모호성**:
- SC-007: "24시간 후 대화 재개 시 95% 정확도"
- 세션 내 컨텍스트 vs 저장된 대화 재개 구분 불명확

**해결 방안**:
```markdown
SC-007 명확화:
"사용자가 24시간 후 저장된 대화를 재개할 때:
- 모든 메시지 내용 100% 보존 (데이터베이스 저장)
- 대화 재개 시 최근 10개 메시지를 LLM 컨텍스트로 로드
- 95% 정확도 기준: 재개 후 첫 질문이 이전 대화 맥락 반영하여 적절한 답변 생성"
```

---

## 🎯 권장 조치사항

### 즉시 조치 (이번 주 내)
1. ✅ 보안 요구사항 추가 (FR-029 ~ FR-033)
2. ✅ 초기 설정 요구사항 추가 (FR-034)
3. ✅ 응답 길이 제한 충돌 해결 (FR-017 수정)

### 릴리스 전 조치
4. ✅ UI 상태 정의 (FR-035)
5. ✅ 컨텍스트 관리 (FR-036)
6. ✅ 오류 메시지 가이드 (FR-037)
7. ✅ 사용량 메트릭 정의 (FR-038)
8. ✅ 빈 상태 UI (FR-039)
9. ✅ 모호한 표현 명확화 (User Story 1, FR-012, SC-007)

### 선택적 개선
10. 브라우저 호환성 (FR-040)
11. 대화 길이 제한 (FR-041)
12. 하드웨어 사양 구체화
13. 로딩 인디케이터 세부사항

---

## 📝 다음 단계

1. **spec.md 업데이트**: 위 개선사항 반영
2. **체크리스트 재검증**: 수정 후 다시 체크
3. **팀 리뷰**: 변경사항 검토 및 승인
4. **plan.md 동기화**: spec 변경사항을 plan에 반영

**예상 작업 시간**: 2-3시간
